#
# Configuration file of Clownfish (TOML format)
#
#

# Consul configurations

[consul]
# The name of data center.
datacenter = "clownf_datacenter"
# The encrypt key of Consul. If omitted, it will be generated by command
# "consul keygen".
# encrypt_key = "1Nij3G+55Hm5TlxypRh+WCghTnE2x3KvNKYx4PPIPpc="

# Servers for Consul
[[consul.servers]]
# Host ID, will use as node_name for consul. Can be a list of hostnames.
# If so, the bind_addr should be a list too.
hostname = "host0-el7-vm[1-3]"
# Adress for Consul communication. Can be a list. The list size should be
# equal to the size of hostname list.
bind_addr = "10.0.1.[1-3]"

# Clients for Consul
[[consul.clients]]
hostname = "host0-el7-vm[4-10]"
bind_addr = "10.0.1.[4-10]"

# Lustre RPMs. If not configured, the Lustre RPMs in the ISO will be used
#[[fs_distributions]]
#fs_distribution_id = "2.12"
#fs_rpm_dir = "/work/lustre_rpms/2.12/x86_64"
# Directory for E2fsprogs RPMs
#e2fsprogs_rpm_dir = "/work/e2fsprogs_rpms/rhel7"

# Array of hosts
[[hosts]]
# The host name. Can be a list of hostnames. If so, the domain_name
# should be a list too.
hostname = "host0-el7-vm[1-5]"
# The SSH key to connect to the host.
# Can be ommitted if pass-less SSH works well.
ssh_identity_file = "/root/.ssh/id_rsa"
# Whether the host needs to install Lustre server RPMs.
# If a Lustre OST/MGS/MDT is configured for the host, the host will be
# considered as a Lustre server regardless of this configuration.
# But even if no Lustre service is configured for the host, by specifying
# this value to true, the host will be considered as a Lustre server too.
fs_server = true
# Whether the host needs to install Lustre RPMs.
# If a Lustre client is configured for the host, the host will be
# considered as a Lustre client regardless of this configuration.
# But even if no Lustre client is configured for the host, by specifying
# this value to true, the host will be considered as a Lustre client too.
#fs_client = false
# A stadalone host will not be managed by Clownfish.
# If this value is configured to true, Clownfish will not install the Lustre
# RPMs on the host and Clownfish commands can not be used upon the host.
# Please note that standalone hosts can not be Lustre clients or servers.
#standalone = false
# IPMI configs to reset this host.
#
# If this is configured, the "libvirt" config of this host should NOT be
# configured.
[hosts.ipmi]
# Interface to use. Options:
# open, imb, lan, lanplus, serial-terminal, serial-basic or usb.
ipmi_interface = "lanplus"
# Remote session username.
ipmi_username = "admin"
# Remote session password.
ipmi_password = "password"
# Remote host name for LAN interface.
#
# If "hostname" is a list, one of "ipmi_hostname" and "ipmi_port" needs to
# be a list, but not both. And the lengths of the two list need to be the
# same. Usually, "ipmi_port" is default (623), and "ipmi_hostname" is a
# list.
ipmi_hostname = "host0"
# Remote RMCP port [default=623]
#
# If "hostname" is a list, one of "ipmi_hostname" and "ipmi_port" needs to
# be a list, but not both. And the lengths of the two list need to be the
# same.
ipmi_port = "623[1-5]"

[[hosts]]
hostname = "host0-el7-vm[6-10]"
ssh_identity_file = "/root/.ssh/id_rsa"
fs_server = true
# If this host is a virtual machine that can be managed by virsh command,
# please configure this section.
#
# If this is configured, the "ipmi" config of this host should NOT be
# configured.
[hosts.libvirt]
# The hostname of libvirt server for this VM.
libvirt_server = "host0"
# The domain name of this VM on the KVM server. If it is a list, it should
# has the same size with the size of hostname list. If not configured, the
# domain name is consider as the same with the hostname.
domain_name = "host0-el7-vm[6-10]"

[[hosts]]
hostname = "host0"
# If do not want to Clownfish to manage this host, configure it to standalone
standalone = true
ssh_identity_file = "/root/.ssh/id_rsa"

# Stanalone MGSs
[[mgs_list]]
# ID of the MGS, should be unique
mgs_id = "lustre_mgs"
# Backfs type
backfstype = "ldiskfs"

# Instances of a MGS.
[[mgs_list.instances]]
# Hostname on which MGS is hosted
hostname = "host0-el7-vm1"
# Device name of MGS
device = "/dev/mapper/lustre_mgs"
# NID of this MGS
nid = "10.0.1.148@tcp"
# Mount point of service
mnt = "/mnt/lustre_mgs"

[[mgs_list.instances]]
hostname = "host0-el7-vm2"
device = "/dev/mapper/lustre_mgs"
nid = "10.0.1.149@tcp"
mnt = "/mnt/lustre_mgs"

# Lustre file systems
[[filesystems]]
# Name of Lustre
fsname = "lustre0"
# MGS ID if the file system is using standalone MGS
mgs_id = "lustre_mgs"

# MDTs of a Lustre file system
[[filesystems.mdts]]
is_mgs = false
# Index of this MDT
index = 0

# Instances of a MDT.
[[filesystems.mdts.instances]]
# Hostname on which MDT is hosted
hostname = "host0-el7-vm1"
# Device name of the MDT
device = "/dev/mapper/lustre0_mdt0"
# NID of the MDT
nid = "10.0.1.148@tcp"
# Mount point of service
mnt = "/mnt/lustre0_mdt0"

[[filesystems.mdts.instances]]
hostname = "host0-el7-vm2"
device = "/dev/mapper/lustre0_mdt0"
nid = "10.0.1.149@tcp"
mnt = "/mnt/lustre0_mdt0"

[[filesystems.mdts]]
is_mgs = false
# Default backfstype is "ldiskfs"
backfstype = "zfs"
index = 1
# For ZFS based MDT/OST, need to specify Zpool name
zpool_name = "lustre0_mdt1"

[[filesystems.mdts.instances]]
hostname = "host0-el7-vm1"
# For ZFS based MDT/OST, need to specify ZFS name as the device
device = "lustre0_mdt1/mdt1"
nid = "10.0.1.148@tcp"
mnt = "/mnt/lustre0_mdt1"
# For ZFS based MDT/OST, need to specify how to create the zpool
zpool_create = "zpool create -f lustre0_mdt1 /dev/mapper/lustre0_mdt1"

[[filesystems.mdts.instances]]
hostname = "host0-el7-vm2"
device = "lustre0_mdt1/mdt1"
nid = "10.0.1.149@tcp"
mnt = "/mnt/lustre0_mdt1"
zpool_create = "zpool create -f lustre0_mdt1 /dev/mapper/lustre0_mdt1"

# OSTs of a Lustre file system
[[filesystems.osts]]
# Index of this OST
index = 0
backfstype = "ldiskfs"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm3"
device = "/dev/mapper/lustre0_ost0"
nid = "10.0.1.251@tcp"
mnt = "/mnt/lustre0_ost0"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm4"
device = "/dev/mapper/lustre0_ost0"
nid = "10.0.1.252@tcp"
mnt = "/mnt/lustre0_ost0"

[[filesystems.osts]]
index = 1
backfstype = "zfs"
zpool_name = "lustre0_ost1"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm3"
device = "lustre0_ost1/ost1"
nid = "10.0.1.251@tcp"
mnt = "/mnt/lustre0_ost1"
zpool_create = "zpool create -f lustre0_ost1 /dev/mapper/lustre0_ost1"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm4"
device = "lustre0_ost1/ost1"
nid = "10.0.1.252@tcp"
mnt = "/mnt/lustre0_ost1"
zpool_create = "zpool create -f lustre0_ost1 /dev/mapper/lustre0_ost1"

[[filesystems.osts]]
index = 2
backfstype = "ldiskfs"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm3"
device = "/dev/mapper/lustre0_ost2"
nid = "10.0.1.251@tcp"
mnt = "/mnt/lustre0_ost2"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm4"
device = "/dev/mapper/lustre0_ost2"
nid = "10.0.1.252@tcp"
mnt = "/mnt/lustre0_ost2"

[[filesystems.osts]]
index = 3
backfstype = "ldiskfs"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm3"
device = "/dev/mapper/lustre0_ost3"
nid = "10.0.1.251@tcp"
mnt = "/mnt/lustre0_ost3"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm4"
device = "/dev/mapper/lustre0_ost3"
nid = "10.0.1.252@tcp"
mnt = "/mnt/lustre0_ost3"

# Clients of a Lustre file system
[[filesystems.clients]]
# Host on which client is hosted
hostname = "host0-el7-vm9"
# Mount point of Lustre client
mnt = "/mnt/lustre0"

[[filesystems]]
fsname = "lustre1"
mgs_id = "lustre_mgs"

[[filesystems.mdts]]
is_mgs = false
index = 0
backfstype = "ldiskfs"

[[filesystems.mdts.instances]]
hostname = "host0-el7-vm5"
device = "/dev/mapper/lustre1_mdt0"
nid = "10.0.1.253@tcp"
mnt = "/mnt/lustre1_mdt0"

[[filesystems.mdts.instances]]
hostname = "host0-el7-vm6"
device = "/dev/mapper/lustre1_mdt0"
nid = "10.0.1.254@tcp"
mnt = "/mnt/lustre1_mdt0"

[[filesystems.mdts]]
is_mgs = false
index = 1
backfstype = "zfs"
zpool_name = "lustre1_mdt1"

[[filesystems.mdts.instances]]
hostname = "host0-el7-vm5"
device = "lustre1_mdt1/mdt1"
nid = "10.0.1.253@tcp"
mnt = "/mnt/lustre1_mdt1"
zpool_create = "zpool create -f lustre1_mdt1 /dev/mapper/lustre1_mdt1"

[[filesystems.mdts.instances]]
hostname = "host0-el7-vm6"
device = "lustre1_mdt1/mdt1"
nid = "10.0.1.254@tcp"
mnt = "/mnt/lustre1_mdt1"
zpool_create = "zpool create -f lustre1_mdt1 /dev/mapper/lustre1_mdt1"

[[filesystems.osts]]
index = 0
backfstype = "ldiskfs"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm7"
device = "/dev/mapper/lustre1_ost0"
nid = "10.0.1.255@tcp"
mnt = "/mnt/lustre1_ost0"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm8"
device = "/dev/mapper/lustre1_ost0"
nid = "10.0.2.197@tcp"
mnt = "/mnt/lustre1_ost0"

[[filesystems.osts]]
index = 1
backfstype = "ldiskfs"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm7"
device = "/dev/mapper/lustre1_ost1"
nid = "10.0.1.255@tcp"
mnt = "/mnt/lustre1_ost1"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm8"
device = "/dev/mapper/lustre1_ost1"
nid = "10.0.2.197@tcp"
mnt = "/mnt/lustre1_ost1"

[[filesystems.osts]]
index = 2
backfstype = "ldiskfs"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm7"
device = "/dev/mapper/lustre1_ost2"
nid = "10.0.1.255@tcp"
mnt = "/mnt/lustre1_ost2"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm8"
device = "/dev/mapper/lustre1_ost2"
nid = "10.0.2.197@tcp"
mnt = "/mnt/lustre1_ost2"

[[filesystems.osts]]
index = 3
backfstype = "ldiskfs"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm7"
device = "/dev/mapper/lustre1_ost3"
nid = "10.0.1.255@tcp"
mnt = "/mnt/lustre1_ost3"

[[filesystems.osts.instances]]
hostname = "host0-el7-vm8"
device = "/dev/mapper/lustre1_ost3"
nid = "10.0.2.197@tcp"
mnt = "/mnt/lustre1_ost3"

[[filesystems.clients]]
hostname = "host0-el7-vm9"
mnt = "/mnt/lustre1"
